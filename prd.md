# 川渝行迹 - 产品需求文档 (PRD)

## 文档信息

| 项目 | 详情 |
|------|------|
| **文档版本** | 1.0 |
| **创建日期** | 2024-02-25 |
| **最后更新** | 2024-02-25 |
| **产品负责人** | [您的姓名] |
| **目标上线** | 2024-03-13 |
| **旅行日期** | 2024-03-15 至 2024-03-21 |

## 1. 产品概述

### 1.1 产品愿景
为川渝地区团体旅行提供简单、直观的行程规划与记录工具，让旅行团队能够协同规划、轻松记录、便捷分享旅行记忆。

### 1.2 问题陈述
- 团队旅行规划分散在多个聊天记录中，难以统一查看
- 旅行照片和记录分散在不同成员的手机中
- 行程变更时通知困难，容易产生混乱
- 旅行结束后回忆整理费时费力

### 1.3 解决方案
一个集中的网页应用，提供：
- 协同行程规划日历
- 实时旅行记录（文字+图片）
- 团队共享访问
- 跨设备响应式设计

### 1.4 MVP 核心价值主张
**"在3月15日前，为7人川渝旅行团队提供基础的协同规划与记录功能"**

## 2. 用户画像与场景

### 2.1 主要用户：团队旅行者
- 年龄：30-60岁
- 技术能力：中等，能使用智能手机应用
- 核心需求：
  - 查看每日行程安排
  - 添加旅行照片和笔记
  - 与队友共享信息
  - 旅行后回顾记忆

### 2.2 使用场景
**场景1：行前规划**
> "老张在电脑上创建了3月15-21日的川渝行程，通过微信分享链接邀请6位老友加入。大家一起在行程日历上添加想去的景点和餐厅。"

**场景2：旅行中记录**
> "在成都宽窄巷子游玩时，老王用手机拍了几张照片，通过应用上传到当天的行程中，并添加了文字说明'这里的三大炮真好吃！'"

**场景3：每日回顾**
> "晚上在酒店，团队打开应用查看第二天的行程安排，同时浏览今天大家上传的照片和记录。"

## 3. 功能需求

### 3.1 P0 - 必须上线功能（MVP核心）

#### 3.1.1 用户认证系统
- **需求ID**: AUTH-001
- **描述**: 用户注册、登录、登出
- **验收标准**:
  - 支持邮箱+密码注册登录
  - 用户会话保持7天
  - 密码重置功能
  - 响应式登录页面

#### 3.1.2 行程管理
- **需求ID**: TRIP-001
- **描述**: 创建和管理旅行行程
- **验收标准**:
  - 创建行程时可设置名称和日期范围（3.15-3.21）
  - 行程列表显示所有参与的行程
  - 删除行程功能（仅创建者）
  - 复制行程模板功能

#### 3.1.3 行程日历视图
- **需求ID**: VIEW-001
- **描述**: 按日期展示行程安排
- **验收标准**:
  - 7天日历网格视图（桌面端）
  - 按日滚动视图（移动端）
  - 点击日期显示当日活动列表
  - 活动显示：时间、标题、地点、类型图标

#### 3.1.4 活动管理
- **需求ID**: ACT-001
- **描述**: 添加、编辑、删除行程活动
- **验收标准**:
  - 添加活动表单：标题、时间、地点、描述、类型
  - 活动类型：景点、餐饮、交通、住宿、其他
  - 预置川渝热门地点选择器（10-15个）
  - 桌面端支持拖拽调整活动顺序
  - 活动编辑和删除功能

#### 3.1.5 团队协作
- **需求ID**: TEAM-001
- **描述**: 邀请和管理团队成员
- **验收标准**:
  - 生成6位字母数字分享码
  - 通过链接/分享码加入行程
  - 显示团队成员列表（头像+姓名）
  - 基础权限控制：创建者（所有权限），成员（添加/编辑活动）

#### 3.1.6 旅行记录
- **需求ID**: LOG-001
- **描述**: 每日旅行笔记记录
- **验收标准**:
  - 每个日期独立的记录区域
  - 富文本编辑器（加粗、斜体、列表、链接）
  - 支持多用户同时编辑（最后保存优先）
  - 自动保存草稿

#### 3.1.7 图片管理
- **需求ID**: IMG-001
- **描述**: 上传和查看旅行照片
- **验收标准**:
  - 单次上传最多10张图片
  - 单张图片最大5MB
  - 支持JPG、PNG格式
  - 客户端图片压缩（保持宽度≤2000px）
  - 按日期分组的图片画廊
  - 图片缩略图预览
  - 点击查看原图

#### 3.1.8 响应式设计
- **需求ID**: UI-001
- **描述**: 适配桌面和移动设备
- **验收标准**:
  - 移动端底部导航栏
  - 触摸友好的按钮尺寸（最小44×44px）
  - 移动端表单优化（适合触摸输入）
  - 桌面端多列布局

### 3.2 P1 - 上线后可添加功能
- 实时聊天/活动评论
- 费用分摊计算器
- 地图集成显示
- 天气信息显示
- 导出PDF行程单

### 3.3 P2 - 未来版本功能
- 语音记录和转文字
- 旅行视频上传
- AI行程建议
- 离线PWA完整支持
- 社交媒体分享模板

## 4. 非功能需求

### 4.1 性能需求
- **页面加载时间**: 首屏加载<3秒（4G网络）
- **图片加载**: 缩略图1秒内显示
- **操作响应**: 用户操作反馈<500毫秒
- **并发用户**: 支持7人同时在线使用

### 4.2 可用性需求
- **学习成本**: 新用户10分钟内能完成基本操作
- **操作一致性**: 相同操作在不同页面保持相同交互
- **错误处理**: 清晰的操作失败提示和恢复建议
- **帮助系统**: 关键操作有工具提示

### 4.3 可靠性需求
- **正常运行时间**: MVP期间>99%
- **数据持久性**: 用户数据100%不丢失
- **错误率**: 用户操作失败率<1%

### 4.4 安全需求
- **认证安全**: 密码哈希存储
- **数据隔离**: 用户只能访问自己参与的行程
- **文件安全**: 图片上传类型和大小限制
- **HTTPS**: 全站强制HTTPS

## 5. 技术架构

### 5.1 技术栈选择
```
前端框架: Next.js 14 (App Router)
开发语言: TypeScript 5.x
样式方案: Tailwind CSS 3.x
状态管理: Zustand + React Query
富文本编辑器: Tiptap
图片上传: React Dropzone
后端服务: Supabase (BaaS)
图片存储: Cloudinary (CDN)
部署平台: Vercel
```

### 5.2 系统架构图
```
┌─────────────────────────────────────────────────┐
│                   用户设备                         │
│       ┌─────────────┐ ┌─────────────┐          │
│       │   移动浏览器  │ │   桌面浏览器  │          │
│       └──────┬──────┘ └──────┬──────┘          │
└──────────────┼────────────────┼──────────────────┘
               │                │
               └───────┬────────┘
                       │
            ┌──────────┴──────────┐
            │      Vercel边缘网络    │
            │  (Next.js应用托管)    │
            └──────────┬──────────┘
                       │
          ┌────────────┴────────────┐
          │      Supabase后端        │
          │  ┌──────────────────┐   │
          │  │   PostgreSQL DB  │   │
          │  │   - 用户数据     │   │
          │  │   - 行程数据     │   │
          │  │   - 活动数据     │   │
          │  └──────────────────┘   │
          │                          │
          │  ┌──────────────────┐   │
          │  │   Auth认证服务   │   │
          │  └──────────────────┘   │
          └────────────┬─────────────┘
                       │
            ┌──────────┴──────────┐
            │    Cloudinary CDN    │
            │   (图片存储优化)      │
            └──────────────────────┘
```

### 5.3 数据模型设计
```sql
-- 核心表结构
Table: profiles
  id (PK, UUID, 关联auth.users)
  username (VARCHAR)
  avatar_url (TEXT)
  created_at (TIMESTAMP)

Table: trips
  id (PK, UUID)
  name (VARCHAR, 行程名称)
  start_date (DATE, '2024-03-15')
  end_date (DATE, '2024-03-21')
  created_by (UUID, 关联profiles)
  share_code (VARCHAR(6), 唯一分享码)
  created_at (TIMESTAMP)
  
Table: trip_members
  trip_id (UUID, 关联trips)
  user_id (UUID, 关联profiles)
  role (ENUM: 'owner', 'editor')
  joined_at (TIMESTAMP)
  
Table: activities
  id (PK, UUID)
  trip_id (UUID, 关联trips)
  day_date (DATE, 活动日期)
  title (VARCHAR)
  description (TEXT)
  location (VARCHAR, 地点名称)
  category (ENUM: 'attraction','food','transport','accommodation','other')
  start_time (TIME)
  end_time (TIME, 可选)
  order_index (INT, 排序)
  created_by (UUID)
  created_at (TIMESTAMP)
  
Table: travel_logs
  id (PK, UUID)
  trip_id (UUID)
  day_date (DATE)
  user_id (UUID)
  content (TEXT, 富文本内容)
  created_at (TIMESTAMP)
  updated_at (TIMESTAMP)
  
Table: trip_images
  id (PK, UUID)
  trip_id (UUID)
  day_date (DATE)
  user_id (UUID)
  image_url (TEXT, Cloudinary URL)
  original_filename (VARCHAR)
  file_size (INT)
  caption (TEXT, 可选描述)
  created_at (TIMESTAMP)
```

### 5.4 API接口设计
```typescript
// RESTful API端点
// 行程相关
GET    /api/trips                    // 获取用户行程列表
POST   /api/trips                    // 创建新行程
GET    /api/trips/[id]               // 获取行程详情
PUT    /api/trips/[id]               // 更新行程信息
DELETE /api/trips/[id]               // 删除行程
POST   /api/trips/[id]/invite        // 生成邀请码
POST   /api/trips/[id]/join          // 加入行程

// 活动相关
GET    /api/trips/[id]/activities    // 获取行程活动
POST   /api/trips/[id]/activities    // 创建活动
PUT    /api/activities/[activityId]  // 更新活动
DELETE /api/activities/[activityId]  // 删除活动
PUT    /api/activities/[id]/reorder  // 重新排序活动

// 记录相关
GET    /api/trips/[id]/logs          // 获取行程记录
POST   /api/trips/[id]/logs          // 创建/更新日志
GET    /api/trips/[id]/logs/[date]   // 获取特定日期记录

// 图片相关
POST   /api/trips/[id]/upload        // 上传图片
GET    /api/trips/[id]/images        // 获取行程图片
DELETE /api/images/[imageId]         // 删除图片
```

## 6. 用户界面设计

### 6.1 页面流程
```
欢迎页 → 登录/注册 → 仪表盘 → [选择行程] → 行程详情页
                                      ↓
                 [行程日历] ← 标签切换 → [每日记录] ← 标签切换 → [图片库]
```

### 6.2 核心页面设计

#### 6.2.1 登录/注册页
- 简洁的品牌标识（"川渝行迹"）
- 邮箱和密码输入框
- "记住我"选项
- 注册链接/切换
- 移动端：全屏表单，大输入框

#### 6.2.2 仪表盘页
- 用户欢迎信息
- "创建新行程" 大按钮
- 现有行程卡片列表（行程名、日期、成员数）
- 桌面端：网格布局，移动端：列表布局

#### 6.2.3 行程详情页（核心）
**桌面端布局：**
```
┌─────────────────────────────────────────┐
│ 行程标题 [编辑]       日期范围    [分享]    │
├─────────────────────────────────────────┤
│ 标签导航: 📅行程 | 📝记录 | 📷图片 | 👥团队 │
├─────────────────────────────────────────┤
│                                           │
│           主要内容区域                     │
│                                           │
└─────────────────────────────────────────┘
```

**移动端布局：**
```
┌─────────────────┐
│ 返回 | 行程标题   │
├─────────────────┤
│                 │
│  主要内容区域    │
│                 │
├─────────────────┤
│ 📅  | 📝 | 📷 | 👥│
└─────────────────┘
```

#### 6.2.4 日历视图
- 7天水平日历（桌面）或垂直列表（移动）
- 每天的活动卡片
- 活动颜色按类型区分
- 点击活动可查看详情或编辑

#### 6.2.5 图片库视图
- 按日期分组的图片网格
- 瀑布流布局（桌面）或单列布局（移动）
- 点击图片放大查看
- 图片悬停显示上传者和描述

### 6.3 设计系统

#### 6.3.1 色彩系统
```css
/* 主色 - 川渝特色 */
--primary-500: #DC2626;  /* 辣椒红 - 主要按钮、重要元素 */
--primary-400: #EF4444;
--primary-300: #FCA5A5;

/* 辅助色 */
--secondary-500: #059669;  /* 竹青 - 成功状态、自然相关 */
--accent-500: #D97706;     /* 蜀锦金 - 高亮、提示 */

/* 中性色 */
--gray-50: #F8FAFC;        /* 背景色 */
--gray-200: #E2E8F0;       /* 边框 */
--gray-600: #475569;       /* 次要文字 */
--gray-800: #1E293B;       /* 主要文字 */
--white: #FFFFFF;
```

#### 6.3.2 字体系统
```css
/* 主要字体 */
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;

/* 字号规范 */
--text-xs: 0.75rem;    /* 12px - 辅助文本 */
--text-sm: 0.875rem;   /* 14px - 正文小 */
--text-base: 1rem;     /* 16px - 正文 */
--text-lg: 1.125rem;   /* 18px - 小标题 */
--text-xl: 1.25rem;    /* 20px - 标题 */
--text-2xl: 1.5rem;    /* 24px - 大标题 */
```

#### 6.3.3 间距系统
```css
--space-1: 0.25rem;   /* 4px */
--space-2: 0.5rem;    /* 8px */
--space-3: 0.75rem;   /* 12px */
--space-4: 1rem;      /* 16px */
--space-6: 1.5rem;    /* 24px */
--space-8: 2rem;      /* 32px */
```

## 7. 开发计划

### 7.1 开发阶段

#### 阶段1：基础框架（2月26日 - 2月29日）
- [ ] 项目初始化（Next.js + TypeScript + Tailwind）
- [ ] Supabase项目创建和配置
- [ ] 基础布局组件开发
- [ ] 用户认证系统实现
- [ ] 部署到Vercel

#### 阶段2：核心功能（3月1日 - 3月6日）
- [ ] 行程CRUD功能
- [ ] 活动管理功能
- [ ] 日历视图组件
- [ ] 团队邀请系统
- [ ] 富文本编辑器集成
- [ ] 图片上传功能

#### 阶段3：优化与测试（3月7日 - 3月12日）
- [ ] 移动端响应式优化
- [ ] 性能优化（图片懒加载、代码分割）
- [ ] 用户测试（邀请2-3位朋友试用）
- [ ] Bug修复和体验优化
- [ ] 部署和监控设置

#### 阶段4：上线准备（3月13日）
- [ ] 最终测试
- [ ] 数据备份设置
- [ ] 用户指南编写
- [ ] 团队培训（7位用户）

### 7.2 资源需求
- 开发人员：1名全栈开发（预估80-100小时）
- 测试人员：产品负责人+2-3位用户
- 服务器成本：免费层（Supabase + Vercel + Cloudinary）
- 域名：使用Vercel免费域名

## 8. 成功指标

### 8.1 MVP成功标准
1. **功能完整性**：P0功能100%完成并通过测试
2. **可用性**：7位用户都能独立完成核心操作
3. **性能**：页面加载时间<3秒，图片上传成功>95%
4. **稳定性**：旅行期间无服务中断
5. **用户满意度**：7位用户中至少5位表示"满意"

### 8.2 数据指标
- 日活跃用户：7人（团队成员）
- 行程创建数：至少1个完整行程
- 活动添加数：>20个行程活动
- 图片上传数：>50张旅行照片
- 记录添加数：每日都有旅行记录

## 9. 风险与应对

### 9.1 技术风险
| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| Supabase免费层限制 | 中 | 中 | 监控使用量，准备降级方案 |
| 图片上传失败 | 低 | 高 | 提供重试机制，本地保存后补传 |
| 实时协作冲突 | 中 | 中 | 实现乐观更新+冲突检测 |
| Vercel部署失败 | 低 | 高 | 准备GitHub Pages备用部署 |

### 9.2 用户风险
| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 用户不会操作 | 中 | 中 | 提供简单引导，设置默认值 |
| 网络连接问题 | 高 | 高 | 关键数据本地缓存，提供离线提示 |
| 图片上传流量大 | 高 | 中 | 强制图片压缩，WiFi下上传提示 |

### 9.3 时间风险
- **最坏情况**：3月13日前无法完成
- **应对方案**：
  1. 优先级排序：先完成行程规划，记录功能简化
  2. 备用方案：使用Google Sheets行程表 + 微信相册
  3. 分阶段上线：先上线基础版，旅行中迭代

## 10. 附录

### 10.1 川渝热门地点预置列表
```json
[
  {"id": "cd-kszl", "name": "宽窄巷子", "city": "成都", "type": "attraction"},
  {"id": "cd-jc", "name": "锦里", "city": "成都", "type": "attraction"},
  {"id": "cd-dxf", "name": "大熊猫繁育基地", "city": "成都", "type": "attraction"},
  {"id": "cd-qc", "name": "青城山", "city": "成都", "type": "attraction"},
  {"id": "cq-hgdd", "name": "洪崖洞", "city": "重庆", "type": "attraction"},
  {"id": "cq-jbs", "name": "解放碑", "city": "重庆", "type": "attraction"},
  {"id": "cq-cjt", "name": "长江索道", "city": "重庆", "type": "attraction"},
  {"id": "cq-qlgb", "name": "千厮门大桥", "city": "重庆", "type": "attraction"},
  {"id": "sc-ems", "name": "峨眉山", "city": "乐山", "type": "attraction"},
  {"id": "sc-lds", "name": "乐山大佛", "city": "乐山", "type": "attraction"},
  {"id": "sc-jsg", "name": "九寨沟", "city": "阿坝", "type": "attraction"},
  {"id": "food-hg", "name": "火锅", "type": "food"},
  {"id": "food-cg", "name": "串串香", "type": "food"},
  {"id": "food-dsc", "name": "担担面", "type": "food"}
]
```

### 10.2 用户快速指南大纲
1. 如何注册账号（2分钟）
2. 如何创建行程（3分钟）
3. 如何邀请朋友（2分钟）
4. 如何添加活动（3分钟）
5. 如何上传照片（2分钟）
6. 如何写旅行记录（2分钟）

### 10.3 测试账户
- 管理员账户：admin@chuan-yu.com
- 测试成员账户：test1@chuan-yu.com ~ test6@chuan-yu.com
- 通用密码：ChuanYu2024!

---

## 文档审批

| 角色 | 姓名 | 审批状态 | 审批日期 | 意见 |
|------|------|----------|----------|------|
| 产品负责人 | [您的姓名] | 待审批 | - | - |
| 技术负责人 | [开发人员姓名] | 待审批 | - | - |
| 测试负责人 | [测试人员姓名] | 待审批 | - | - |

---

**文档版本历史**
- v1.0 (2024-02-25): 初始版本创建

**下一步行动**
1. 与技术团队评审此PRD
2. 确认开发资源可用性
3. 开始阶段1开发
4. 准备测试计划和用户指南